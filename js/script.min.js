window.ItineraryMap=function(a,b,c){"use strict";"object"!=typeof b&&(b={}),"object"!=typeof c&&(c={}),"number"!=typeof b.centerLat&&(b.centerLat=48.5631),"number"!=typeof b.centerLng&&(b.centerLng=3.28594),"object"!=typeof b.steps&&(b.steps=void 0),"boolean"!=typeof c.displayMarkers&&(c.displayMarkers=!0),"boolean"!=typeof c.geolocation&&(c.geolocation=!0),"boolean"!=typeof c.geolocationCentered&&(c.geolocationCentered=!0),"number"!=typeof c.zoom&&(c.zoom=15),"boolean"!=typeof c.static&&(c.static=!1),this.gMap=void 0,this.gCenter=new google.maps.LatLng(b.centerLat,b.centerLng),this.gCenterMarker=null,this.gMarkers=[],this.gWindows=[];var d={oldPath:null,lastStepIndex:0,markers:[]},e=this,f=function(a,b){var c=8,d=[];if(b>a.length-1)return[d,null];var e=b+c;e+=2,e>a.length-1&&(e=a.length);for(var f=b;e>f;f++)d.push(a[f]);return e!=a.length?[d,e-1]:[d,null]},g=function(a,b,c,e,h){e="undefined"!=typeof e?e:0,h="undefined"!=typeof h?h:[];var i=f(b,e),j=i[0].shift().location,k=i[0].pop().location,l={origin:j,destination:k,waypoints:i[0],travelMode:google.maps.TravelMode.WALKING,unitSystem:google.maps.UnitSystem.METRIC,provideRouteAlternatives:!1,avoidHighways:!1,avoidTolls:!1};a.route(l,function(e,f){f===google.maps.DirectionsStatus.OK?(h=h.concat(e.routes[0].overview_path),d.oldPath=h,null!==i[1]?(d.lastStepIndex=i[1],g(a,b,c,i[1],h)):c(h)):(h=d.oldPath,d.lastStepIndex=d.lastStepIndex+1,null!==i[d.lastStepIndex]?g(a,b,c,d.lastStepIndex,h):c(h))})},h=function(a){navigator.geolocation&&(navigator.geolocation.getCurrentPosition(function(b){a&&e.center(b.coords.latitude,b.coords.longitude),e.gCenterMarker=e.addMarker(b.coords.latitude,b.coords.longitude,"","X","1C327F","ffffff")}),navigator.geolocation.watchPosition(function(a){null!==e.gCenterMarker&&e.gCenterMarker.setPosition(new google.maps.LatLng(a.coords.latitude,a.coords.longitude))}))},i=function(a,b){var c=new google.maps.DirectionsService,d=1,f=[];for(var h in a){var i=a[h],j=i.position.lat,k=i.position.long;if(f.push({location:new google.maps.LatLng(j,k)}),b){var l=e.addMarker(j,k,i.name,d,i.bgColor,i.textColor);e.addWindow(i.content,l)}d+=1}g(c,f,function(a){new google.maps.Polyline({clickable:!1,path:a,map:e.gMap,strokeColor:"#741321",strokeOpacity:1,strokeWeight:2})})},j={center:this.gCenter,zoom:c.zoom,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,draggable:!c.static,scrollwheel:!c.static,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]};this.gMap=new google.maps.Map(a,j),c.geolocation&&h(c.geolocationCentered),void 0!==b.steps&&i(b.steps,c.displayMarkers)},ItineraryMap.prototype.center=function(a,b){return"number"!=typeof a&&(a=0),"number"!=typeof b&&(b=0),this.gCenter=new google.maps.LatLng(a,b),this.gMap.setCenter(this.gCenter),null!==this.gCenterMarker&&this.gCenterMarker.setPosition(this.gCenter),this},ItineraryMap.prototype.addWindow=function(a,b){"string"!=typeof a&&(a="");var c=new google.maps.InfoWindow({content:a});if(this.gWindows.push(c),"object"==typeof b){var d=this;google.maps.event.addListener(b,"click",function(){$.each(d.gWindows,function(a,b){b.close()}),c.open(d.gMap,b)})}return c},ItineraryMap.prototype.addMarker=function(a,b,c,d,e,f){"number"!=typeof a&&(a=0),"number"!=typeof b&&(b=0),void 0===c&&(c=""),void 0===d&&(d="X"),"string"!=typeof e&&(e="000000"),"string"!=typeof f&&(f="ffffff");var g="http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+d+"|"+e+"|"+f,h=new google.maps.Marker({position:new google.maps.LatLng(a,b),map:this.gMap,title:c,icon:g});return this.gMarkers.push(h),h},function(a){"use strict";function b(){switch(d(),a("body").attr("id")){case"page-itinerary-summary":g();break;case"page-itinerary-download":x();break;case"page-itinerary-step":m();break;case"page-itinerary-steps":k();break;case"page-itineraries":j();break;case"page-map":i();break;case"page-share":p()}}function c(){return"localStorage"in window||null!==window.localStorage}function d(){a("#hamburger").click(e),a("#hamburgerLayer").click(e),a("nav").bind("touchmove",function(a){a.stopPropagation()}),a("a.disabled").click(function(a){a.preventDefault()})}function e(){var b=a("nav"),c=a("#hamburgerLayer"),d=300;c.hasClass("hidden")?(b.animate({marginLeft:"0"},d),c.removeClass("hidden"),c.animate({opacity:"0.8"},d),a("body").bind("touchmove",function(a){a.preventDefault()})):(b.animate({marginLeft:"-75%"},500),c.animate({opacity:"0"},d,"swing",function(){c.addClass("hidden")}),a("body").unbind("touchmove"))}function f(){if(void 0!==window.localStorage.itineraries){var b=a("section").data("itinerary"),c=JSON.parse(window.localStorage.itineraries);if(c.hasOwnProperty(b)){var d=a("a#start-itinerary");void 0!==d.data("msg-resume")&&d.html(d.data("msg-resume"))}}}function g(){f()}function h(b){var c=null;if(b.hasClass("generic"))c=new ItineraryMap(b[0]);else{var d=b.data("steps"),e=b.data("itinerary"),f=JSON.parse(window.localStorage.itineraries),g=parseInt(f[e].currentStep),h=a.map(d,function(a,b){return b}),i=h[g],j="ffffff",k="009E2F",l=b.data("basestepurl"),m=f[e].completedSteps;for(var n in d){var o=d[n],p=h.indexOf(n);o.bgColor=n===i?"741321":-1===m.indexOf(p)?"000000":k;var q=l+n;o.textColor=j,o.content='<div class="steplink"><a href="'+q+'" title="">'+o.name+"</a></div>"}c=new ItineraryMap(b[0],{steps:d,centerLat:d[i].position.lat,centerLng:d[i].position.long},{geolocation:!0,displayMarkers:!0,zoom:15})}}function i(){h(a(".map"))}function j(){}function k(){var b=a(".steps"),c=a(".progress"),d=b.data("itinerary"),e=JSON.parse(window.localStorage.itineraries),f=parseInt(e[d].currentStep),g=e[d].completedSteps,h=c.data("numsteps");console.log("Current step index = "+f),console.log("num steps = "+h);var i=f/(h-1)*100;c.find(".start + .line").css("width",i+"%");var j=b.children("li.step");j.each(function(b,c){var d=a(c),e=d.data("position");e===f?d.removeClass("state-locked").addClass("state-current"):-1!==a.inArray(e,g)&&d.removeClass("state-locked").addClass("state-complete")})}function l(){var b=a(".question form"),c=b.find(".choice input:checked");c.parents(".choice").addClass("checked"),a(".question form").addClass("submitted");var d=JSON.parse(window.localStorage.itineraries),e=a("section"),f=parseInt(e.data("stepindex")),g=e.data("itinerary");return-1===a.inArray(f,d[g].completedSteps)&&d[g].completedSteps.push(f),window.localStorage.itineraries=JSON.stringify(d),!1}function m(){var b=JSON.parse(window.localStorage.itineraries),c=a("section"),d=parseInt(c.data("stepindex")),e=c.data("itinerary");b[e].currentStep=d,window.localStorage.itineraries=JSON.stringify(b),0===a(".question").length?(-1===a.inArray(d,b[e].completedSteps)&&b[e].completedSteps.push(d),window.localStorage.itineraries=JSON.stringify(b)):a(".question form").submit(l)}function n(){window.twttr=function(a,b,c){var d,e=a.getElementsByTagName(b)[0],f=window.twttr||{};if(!a.getElementById(c))return d=a.createElement(b),d.id=c,d.src="https://platform.twitter.com/widgets.js",e.parentNode.insertBefore(d,e),f._e=[],f.ready=function(a){f._e.push(a)},f}(document,"script","twitter-wjs")}function o(){!function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/fr_FR/sdk.js#xfbml=1&version=v2.0",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk")}function p(){n(),o()}function q(){if(!c())return void(window.location="notsupported");var b=a(".downloader").data("itinerary"),d={currentStep:0,completedSteps:[]},e={};void 0!==window.localStorage.itineraries?(e=JSON.parse(window.localStorage.itineraries),void 0===e[b]&&(e[b]=d)):e[b]=d,window.localStorage.setItem("itineraries",JSON.stringify(e))}function r(){var b=a(".downloader").data("stepurl"),c=a(".downloader").data("itinerary"),d=JSON.parse(window.localStorage.itineraries),e=d[c].currentStep,f=a(".downloader").data("steps")[e];b+=f,window.location=b}function s(){var b=a("#download-meter"),c=parseInt(b.data("numfiles")),d=parseInt(b.data("filesdownloaded"));b.data("filesdownloaded",d+1);var e=Math.round(d/c*100);0===c&&(e=0),a("#download-meter span").css("width",e+"%")}function t(){r()}function u(){a("#download-meter span").css("width","100%"),r()}function v(){window.applicationCache.swapCache(),r()}function w(){r()}function x(){return"applicationCache"in window&&null!==window.applicationCache?(window.applicationCache.addEventListener("progress",s),window.applicationCache.addEventListener("cached",t),window.applicationCache.addEventListener("updateready",v),window.applicationCache.addEventListener("noupdate",u),window.applicationCache.addEventListener("error",w),void q()):void(window.location="notsupported")}a(document).ready(b)}(jQuery);